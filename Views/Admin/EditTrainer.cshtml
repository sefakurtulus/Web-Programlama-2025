@model GymManagementSystem.Models.Entities.Trainer

@{
    ViewData["Title"] = "Antren√∂r D√ºzenle";
    var existingSpecialties = Model.Specialties?.Select(s => s.SpecialtyName).ToList() ?? new List<string>();
    var existingAvailabilities = Model.Availabilities?.ToList() ?? new List<GymManagementSystem.Models.Entities.TrainerAvailability>();
}

<div class="row justify-content-center">
    <div class="col-md-10">
        <div class="card shadow">
            <div class="card-header bg-info text-white">
                <h3 class="mb-0">‚úèÔ∏è Antren√∂r D√ºzenle</h3>
            </div>
            <div class="card-body">
                <form asp-action="EditTrainer" method="post" id="trainerForm">
                    <input type="hidden" asp-for="Id" />
                    <input type="hidden" asp-for="CreatedAt" />
                    
                    <!-- Temel Bilgiler -->
                    <h5 class="border-bottom pb-2 mb-3">üë§ Temel Bilgiler</h5>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label asp-for="FullName" class="form-label">Ad Soyad *</label>
                            <input asp-for="FullName" class="form-control" required />
                            <span asp-validation-for="FullName" class="text-danger"></span>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label asp-for="Email" class="form-label">Email *</label>
                            <input asp-for="Email" type="email" class="form-control" required />
                            <span asp-validation-for="Email" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label asp-for="PhoneNumber" class="form-label">Telefon</label>
                            <input asp-for="PhoneNumber" type="tel" class="form-control" />
                            <span asp-validation-for="PhoneNumber" class="text-danger"></span>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label asp-for="HourlyRate" class="form-label">Saatlik √úcret (‚Ç∫) *</label>
                            <input asp-for="HourlyRate" type="number" step="0.01" class="form-control" required />
                            <span asp-validation-for="HourlyRate" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label asp-for="Bio" class="form-label">Biyografi</label>
                        <textarea asp-for="Bio" class="form-control" rows="2"></textarea>
                    </div>

                    <!-- Uzmanlƒ±k Alanlarƒ± -->
                    <h5 class="border-bottom pb-2 mb-3 mt-4">üéØ Uzmanlƒ±k Alanlarƒ±</h5>
                    
                    <div class="mb-3">
                        <label class="form-label">Uzmanlƒ±k Alanlarƒ± Se√ß (En az 1 tane)</label>
                        <div class="row">
                            @{
                                var specialtyOptions = new[] { "Kilo Verme", "Kas Yapma", "Yoga", "Pilates", "Cardio", "Crossfit", "V√ºcut Geli≈ütirme", "Zumba" };
                                var spIndex = 1;
                            }
                            @foreach (var specialty in specialtyOptions)
                            {
                                var isChecked = existingSpecialties.Contains(specialty);
                                <div class="col-md-3">
                                    <div class="form-check">
                                        <input type="checkbox" class="form-check-input" name="Specialties" value="@specialty" id="sp@(spIndex)" @(isChecked ? "checked" : "")>
                                        <label class="form-check-label" for="sp@(spIndex)">@specialty</label>
                                    </div>
                                </div>
                                spIndex++;
                                if (spIndex % 4 == 1 && spIndex > 1)
                                {
                                    @:</div><div class="row mt-2">
                                }
                            }
                        </div>
                    </div>

                    <!-- M√ºsaitlik Saatleri -->
                    <h5 class="border-bottom pb-2 mb-3 mt-4">üìÖ M√ºsaitlik Saatleri</h5>
                    
                    <div class="table-responsive">
                        <table class="table table-bordered table-sm">
                            <thead class="table-light">
                                <tr>
                                    <th width="15%">G√ºn</th>
                                    <th width="15%">Aktif</th>
                                    <th width="35%">Ba≈ülangƒ±√ß Saati</th>
                                    <th width="35%">Biti≈ü Saati</th>
                                </tr>
                            </thead>
                            <tbody>
                                @{
                                    var days = new[] { 
                                        new { Value = DayOfWeek.Monday, Text = "Pazartesi" },
                                        new { Value = DayOfWeek.Tuesday, Text = "Salƒ±" },
                                        new { Value = DayOfWeek.Wednesday, Text = "√áar≈üamba" },
                                        new { Value = DayOfWeek.Thursday, Text = "Per≈üembe" },
                                        new { Value = DayOfWeek.Friday, Text = "Cuma" },
                                        new { Value = DayOfWeek.Saturday, Text = "Cumartesi" },
                                        new { Value = DayOfWeek.Sunday, Text = "Pazar" }
                                    };
                                    int dayIndex = 0;
                                }
                                @foreach (var day in days)
                                {
                                    var availability = existingAvailabilities.FirstOrDefault(a => a.DayOfWeek == day.Value);
                                    var isAvailable = availability != null;
                                    var startTime = availability?.StartTime.ToString(@"hh\:mm") ?? "09:00";
                                    var endTime = availability?.EndTime.ToString(@"hh\:mm") ?? "17:00";
                                    
                                    <tr>
                                        <td><strong>@day.Text</strong></td>
                                        <td>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input day-checkbox" 
                                                       id="day@(dayIndex)" 
                                                       name="AvailableDays" 
                                                       value="@day.Value"
                                                       onchange="toggleTimeInputs('@dayIndex')"
                                                       @(isAvailable ? "checked" : "")>
                                                <label class="form-check-label" for="day@(dayIndex)">M√ºsait</label>
                                            </div>
                                        </td>
                                        <td>
                                            <input type="time" class="form-control form-control-sm @(isAvailable ? "border-info" : "")" 
                                                   id="start@(dayIndex)" 
                                                   name="StartTimes_@day.Value" 
                                                   value="@startTime" 
                                                   @(!isAvailable ? "disabled" : "") />
                                        </td>
                                        <td>
                                            <input type="time" class="form-control form-control-sm @(isAvailable ? "border-info" : "")" 
                                                   id="end@(dayIndex)" 
                                                   name="EndTimes_@day.Value" 
                                                   value="@endTime" 
                                                   @(!isAvailable ? "disabled" : "") />
                                        </td>
                                    </tr>
                                    dayIndex++;
                                }
                            </tbody>
                        </table>
                    </div>

                    <div class="alert alert-info mt-3">
                        <strong>üí° ƒ∞pucu:</strong> Deƒüi≈üiklikler t√ºm uzmanlƒ±k ve m√ºsaitlik bilgilerini g√ºnceller.
                    </div>

                    <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
                        <a asp-action="ManageTrainers" class="btn btn-secondary">
                            ƒ∞ptal
                        </a>
                        <button type="submit" class="btn btn-info text-white">
                            üíæ Deƒüi≈üiklikleri Kaydet
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script>
        function toggleTimeInputs(index) {
            const checkbox = document.getElementById('day' + index);
            const startInput = document.getElementById('start' + index);
            const endInput = document.getElementById('end' + index);
            
            if (checkbox.checked) {
                startInput.disabled = false;
                endInput.disabled = false;
                startInput.classList.add('border-info');
                endInput.classList.add('border-info');
            } else {
                startInput.disabled = true;
                endInput.disabled = true;
                startInput.classList.remove('border-info');
                endInput.classList.remove('border-info');
            }
        }

        // Validation: En az 1 uzmanlƒ±k se√ßilmeli
        document.getElementById('trainerForm').addEventListener('submit', function(e) {
            const specialties = document.querySelectorAll('input[name="Specialties"]:checked');
            if (specialties.length === 0) {
                e.preventDefault();
                alert('L√ºtfen en az 1 uzmanlƒ±k alanƒ± se√ßin!');
                return false;
            }
        });
    </script>
    <style>
        .table-sm td, .table-sm th {
            vertical-align: middle;
        }
        .border-info {
            border-color: #0dcaf0 !important;
        }
    </style>
}

